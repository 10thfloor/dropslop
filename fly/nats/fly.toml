# NATS Server for Product Drop
# Internal-only service for pub/sub messaging

app = "drop-nats"
primary_region = "sjc"

[build]
dockerfile = "Dockerfile"

[mounts]
source = "nats_data"
destination = "/data"

# Main NATS port (4222) - internal only, no public exposure
[[services]]
protocol = "tcp"
internal_port = 4222
auto_stop_machines = false
auto_start_machines = true
min_machines_running = 1

[[services.ports]]
port = 4222

[services.concurrency]
type = "connections"
hard_limit = 10000
soft_limit = 8000

# Health check using NATS monitoring endpoint
[checks]
[checks.health]
grace_period = "10s"
interval = "30s"
method = "GET"
path = "/healthz"
port = 8222
timeout = "5s"
type = "http"

[vm]
memory = "512mb"
cpu_kind = "shared"
cpus = 1
